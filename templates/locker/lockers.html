{% extends 'base.html' %}

{% load static %}
{% block extra_css %}
  <!-- DataTables -->
  <link href="https://cdn.datatables.net/2.2.2/css/dataTables.bootstrap5.css" rel="stylesheet">
  <link href="{% static 'css/base/dataTables.custom.css' %}" rel="stylesheet">
{% endblock %}

{% block title %}LockIn - Armários{% endblock %}

{% block content %}
<!--begin::Locker List-->
<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 mt-3 mb-3 mt-lg-5 mb-lg-5">
  <div class="card p-3 p-lg-5">
    <div
      class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4 mb-lg-5 border-bottom">
      <h1 class="h2">Armários</h1>
      <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{% url 'add_locker' %}" class="btn custom"><i class="bi bi-plus-lg"></i> Novo Armário</a>       
      </div>
    </div>

    {% include "partials/forms/messages.html" %}
    {% include "partials/confirm_delete_modal.html" %}
    
    <div class="table-responsive">
      <table class="table" id="lockers">
        <thead>
          <tr>
            <th>Nº</th>
            <th>Empresa</th>
            <th>Usuário</th>
            <th>Cartão</th>
            <th>Disponibilidade</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for locker in lockers %}
          <tr>
            <td>{{ locker.number|stringformat:"02d" }}</td>
            <td>{{ locker.enterprise.business_name }}</td>
            <td>
              {% if locker.client %}
              {{ locker.client.name }}
              {% else %} 
              -----
              {% endif %}
            </td>
            <td>
               {% if locker.card_id %}
                {{ locker.card_id }}
                {% else %} 
                -----
                {% endif %}

            </td>      
            <td>
              {% if locker.available %}
              <div class="badge badge-success">Disponível</div>
              {% else %} 
              <div class="badge badge-danger">Ocupado</div>
              {% endif %}
            </td>  
            <td>
              <a href="{% url 'update_locker' locker.id %}" class="btn btn-update" alt="Editar">
                <i class="bi bi-pencil"></i>
              </a>
              <a class="btn btn-sm btn-delete" alt="Excluir" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-name="Armário {{ locker.number }}" data-url="{% url 'delete_locker' locker.id %}">
                <i class="bi bi-trash"></i>
              </a>
          </td>      
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">Nenhum armário cadastrado.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% include 'partials/pagination.html' %} 
    </div>  
  </div>
</main>
<!--end::Locker List-->
{% endblock %}

{% block extra_js %}
{% include "partials/list_extra_js.html" %}

{% if lockers %}
<script>
$(document).ready(function() {
  // Se a tabela não for inicializada ainda, inicialize
  if (!$.fn.dataTable.isDataTable('#lockers')) {
    $('#lockers').DataTable({
      searching:false,
      paging: false,            // remove paginação
      lengthChange: false,      // remove seletor "mostrar X registros"
      info: false,              // remove texto "Mostrando X a Y de Z registros"
      
      columnDefs: [
            { width: '10%', targets: 0 },  // Primeira coluna (Número do Armário)
            { width: '30%', targets: 1 },  // Segunda coluna (Empresa)
            { width: '30%', targets: 2 },  // Terceira coluna (Usuário)
            { width: '10%', targets: 3 },  // Quarta coluna (Cartão)
            { width: '10%', targets: 4 },  // Quinta coluna (Disponível)
            { width: '10%', targets: 5 }   // Sexta coluna (Ações)
        ],
      "language": {
        "sProcessing": "Processando...",       
        "sZeroRecords": "Nenhum registro encontrado",
        "sSearch": "Pesquisar:"       
      }
    });
  }
});
</script>
{% endif %}

{% endblock %}